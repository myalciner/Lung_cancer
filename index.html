<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Decision Tree Simulation - Lung Cancer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .scenario-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }
        
        .scenario-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .scenario-content {
            font-size: 16px;
            line-height: 1.7;
        }
        
        .decision-container {
            margin-top: 25px;
        }
        
        .decision-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            background-color: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .option:hover {
            background-color: #f1f8ff;
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .result-container {
            display: none;
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border-left: 4px solid #e74c3c;
        }
        
        .result-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .result-content {
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 20px;
        }
        
        .continue-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .continue-btn:hover {
            background-color: #2980b9;
        }
        
        .time-loss {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .report {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #3498db;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .step-indicator {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .positive {
            background-color: #d5f4e6;
            border-left: 4px solid #2ecc71;
        }
        
        .negative {
            background-color: #fdeaea;
            border-left: 4px solid #e74c3c;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Clinical Decision Tree Simulation</h1>
            <div class="subtitle">Lung Cancer Case - Immunotherapy Focus</div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="step-indicator" id="step-indicator">Stage 1 / 5</div>
        </header>
        
        <div id="scenario-1" class="scenario-container">
            <h2 class="scenario-title">Scenario Start: New Diagnosis</h2>
            <div class="scenario-content">
                <p><strong>Patient:</strong> 58-year-old female with 35 pack/year smoking history.</p>
                <p><strong>Symptoms:</strong> Persistent cough, loss of appetite, unintentional weight loss of 6 kg over 2 months.</p>
                <p><strong>Examination:</strong> Normal.</p>
                <p><strong>Chest X-ray:</strong> Suspicious mass in right lung.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 1A: Your initial imaging choice?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(1, 'A')">A) Contrast-enhanced Chest and Upper Abdomen CT</div>
                    <div class="option" onclick="selectOption(1, 'B')">B) Direct PET-CT</div>
                    <div class="option" onclick="selectOption(1, 'C')">C) Refer patient to Pulmonology</div>
                </div>
            </div>
        </div>
        
        <div id="result-1" class="result-container">
            <!-- Result content will be populated by JavaScript -->
        </div>
        
        <div id="scenario-2" class="scenario-container hidden">
            <h2 class="scenario-title">Stage 2: Diagnosis and Staging</h2>
            <div class="scenario-content">
                <p>Based on the patient's imaging results, further diagnostic planning is required.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 1B: Your next step after CT?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(2, 'A')">A) Perform PET-CT for staging</div>
                    <div class="option" onclick="selectOption(2, 'B')">B) Bronchoscopy + EBUS for biopsy</div>
                </div>
            </div>
        </div>
        
        <div id="result-2" class="result-container">
            <!-- Result content will be populated by JavaScript -->
        </div>
        
        <div id="scenario-3" class="scenario-container hidden">
            <h2 class="scenario-title">Stage 3: Biomarker and Treatment Plan</h2>
            <div class="scenario-content">
                <p>Pathology report: <strong>Squamous Cell Lung Carcinoma</strong>. Stage: IIIB (T3N2M0).</p>
                <p>Biomarker evaluation is needed to determine the patient's treatment plan.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 2: Pathology report is in. Next step?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(3, 'A')">A) Plan chemoradiotherapy directly</div>
                    <div class="option" onclick="selectOption(3, 'B')">B) Request PD-L1 staining (TPS) on tumor tissue</div>
                    <div class="option" onclick="selectOption(3, 'C')">C) Start chemotherapy</div>
                </div>
            </div>
        </div>
        
        <div id="result-3" class="result-container">
            <!-- Result content will be populated by JavaScript -->
        </div>
        
        <div id="scenario-4" class="scenario-container hidden">
            <h2 class="scenario-title">Stage 4: Treatment Initiation and First Challenge</h2>
            <div class="scenario-content">
                <p>PD-L1 TPS result: <strong>60%</strong>. Based on this result, immunotherapy monotherapy was initiated after discussion with the patient.</p>
                <p>After the 3rd treatment cycle, the patient complains of mild joint pain and fatigue.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 3: How do you manage these symptoms?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(4, 'A')">A) These are insignificant, continue treatment.</div>
                    <div class="option" onclick="selectOption(4, 'B')">B) Skip one dose and observe.</div>
                    <div class="option" onclick="selectOption(4, 'C')">C) Consider immune-related adverse events, provide symptomatic support with simple analgesics and close monitoring.</div>
                </div>
            </div>
        </div>
        
        <div id="result-4" class="result-container">
            <!-- Result content will be populated by JavaScript -->
        </div>
        
        <div id="scenario-5" class="scenario-container hidden">
            <h2 class="scenario-title">Stage 5: Critical Adverse Event Management</h2>
            <div class="scenario-content">
                <p>After the 6th treatment cycle, the patient presents to the emergency department with acute onset shortness of breath and dry cough.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 4A: Your emergency approach?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(5, 'A')">A) Order Chest CT</div>
                    <div class="option" onclick="selectOption(5, 'B')">B) Immediately start high-dose IV Methylprednisolone (1-2 mg/kg)</div>
                    <div class="option" onclick="selectOption(5, 'C')">C) Start antibiotics and treat as pneumonia</div>
                </div>
            </div>
        </div>
        
        <div id="result-5" class="result-container">
            <!-- Result content will be populated by JavaScript -->
        </div>
        
        <div id="final-result" class="scenario-container hidden">
            <h2 class="scenario-title">Simulation Complete!</h2>
            <div class="scenario-content" id="final-content">
                <!-- Final content will be populated by JavaScript -->
            </div>
            <button class="continue-btn" onclick="restartSimulation()">Restart Simulation</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let timeLoss = 0;
        let score = 0;
        const totalSteps = 5;
        
        const stepTitles = [
            "Scenario Start",
            "Diagnosis and Staging",
            "Biomarker and Treatment Plan",
            "Treatment Initiation and First Challenge",
            "Critical Adverse Event Management"
        ];
        
        function updateProgress() {
            const progress = document.getElementById('progress');
            const stepIndicator = document.getElementById('step-indicator');
            const percentage = (currentStep / totalSteps) * 100;
            progress.style.width = `${percentage}%`;
            stepIndicator.textContent = `Stage ${currentStep} / ${totalSteps} - ${stepTitles[currentStep-1]}`;
        }
        
        function selectOption(step, option) {
            // Hide current scenario
            document.getElementById(`scenario-${step}`).classList.add('hidden');
            
            // Show result
            const resultContainer = document.getElementById(`result-${step}`);
            resultContainer.style.display = 'block';
            
            // Populate result based on step and option
            let resultHTML = '';
            let feedbackHTML = '';
            let timeLossIncrement = 0;
            let scoreIncrement = 0;
            
            switch(step) {
                case 1:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">Correct Approach</h3><div class="result-content"><p>You ordered Contrast-enhanced Chest CT. This is the most appropriate first step to evaluate the anatomical features of the mass and plan biopsy.</p><div class="report"><strong>CT Report:</strong><br>Irregular bordered mass approximately 4.5 cm in diameter in right upper lobe. Pathological lymph nodes in paratracheal and subcarinal areas. Consistent with Stage IIIB (T2bN2M0) lung carcinoma. Suitable for biopsy.</div></div>';
                            feedbackHTML = '<div class="feedback positive">Excellent! You ordered the correct imaging in the proper sequence. No time was lost.</div>';
                            scoreIncrement = 20;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">Early PET-CT</h3><div class="result-content"><p>You ordered direct PET-CT. The radiologist delayed the report, stating that contrast CT was needed first for staging.</p><div class="report"><strong>Radiologist Note:</strong><br>"Anatomical detail insufficient for CT-guided biopsy. Contrast-enhanced Chest CT recommended."</div></div>';
                            feedbackHTML = '<div class="feedback negative">Diagnostic delay occurred. Contrast CT should have been performed first to evaluate the anatomical features of the mass.</div>';
                            timeLossIncrement = 1;
                            scoreIncrement = 10;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">Immediate Referral</h3><div class="result-content"><p>You referred the patient directly to a Pulmonologist. The specialist could not evaluate without basic imaging and ordered Contrast-enhanced Chest CT.</p><div class="report"><strong>Contrast Chest CT Report (1 Week Later):</strong><br>Irregular bordered mass lesion approximately 4.5 cm in diameter in right upper lobe. Pathological sized lymph nodes present in mediastinum. Primary consideration for lung neoplasm.</div></div>';
                            feedbackHTML = '<div class="feedback negative">You lost 1 week with pre-imaging referral. You now have the CT result and can proceed to the next step.</div>';
                            timeLossIncrement = 1;
                            scoreIncrement = 5;
                            break;
                    }
                    break;
                case 2:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">Staging First</h3><div class="result-content"><p>You chose to perform PET-CT for staging first. Staging was completed but the pathologist reported that basic CT images were still needed for biopsy and PD-L1 testing since you had no diagnostic sample.</p></div>';
                            feedbackHTML = '<div class="feedback negative">Diagnostic delay occurred. Biopsy for diagnosis should be performed first, then staging.</div>';
                            timeLossIncrement = 1;
                            scoreIncrement = 10;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">Correct Sequence</h3><div class="result-content"><p>You requested bronchoscopy with biopsy from the mass and EBUS from lymph nodes. This is the correct sequence.</p><div class="report"><strong>Pathology Report:</strong><br>Squamous Cell Lung Carcinoma. Stage: IIIB (T3N2M0).</div></div>';
                            feedbackHTML = '<div class="feedback positive">Excellent! You established the diagnosis first. You can now proceed to staging and biomarker tests.</div>';
                            scoreIncrement = 20;
                            break;
                    }
                    break;
                case 3:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">Incomplete Evaluation</h3><div class="result-content"><p>You planned chemoradiotherapy directly. However, you risk missing the opportunity for immunotherapy in a patient who may have high PD-L1 expression.</p></div>';
                            feedbackHTML = '<div class="feedback negative">PD-L1 testing was skipped. The patient\'s chance of benefiting from immunotherapy was not evaluated.</div>';
                            scoreIncrement = 5;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">Gold Standard</h3><div class="result-content"><p>You requested PD-L1 staining. This is critical for patient selection for immunotherapy.</p><div class="report"><strong>PD-L1 TPS Result: 60%</strong><br>This result indicates the patient is a strong candidate for immunotherapy monotherapy.</div></div>';
                            feedbackHTML = '<div class="feedback positive">Excellent! You evaluated the patient\'s suitability for personalized therapy with biomarker testing.</div>';
                            scoreIncrement = 20;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">Outdated Approach</h3><div class="result-content"><p>You started chemotherapy directly. In this patient with potentially high PD-L1 expression, immunotherapy might have been a more effective option.</p></div>';
                            feedbackHTML = '<div class="feedback negative">The patient was deprived of the potential superiority of immunotherapy.</div>';
                            scoreIncrement = 5;
                            break;
                    }
                    break;
                case 4:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">Insufficient Assessment</h3><div class="result-content"><p>You considered the side effects insignificant and continued treatment. The patient returned at the next follow-up with much more severe arthritis-like complaints. The adverse event had progressed.</p></div>';
                            feedbackHTML = '<div class="feedback negative">Immune-related adverse events should be recognized and managed early.</div>';
                            scoreIncrement = 5;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">Unnecessary Interruption</h3><div class="result-content"><p>You skipped one dose. An effective treatment was unnecessarily interrupted. This is a protocol deviation.</p></div>';
                            feedbackHTML = '<div class="feedback negative">For Grade 1 adverse events, management with supportive care is more appropriate than discontinuing the drug.</div>';
                            scoreIncrement = 10;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">Correct Management</h3><div class="result-content"><p>Rash and diarrhea are common, usually Grade 1-2 adverse events with immunotherapy. You provided support with topical cream and antidiarrheals while continuing the drug.</p></div>';
                            feedbackHTML = '<div class="feedback positive">Excellent! You correctly managed mild immune-related adverse events. The patient continues to benefit from treatment.</div>';
                            scoreIncrement = 20;
                            break;
                    }
                    break;
                case 5:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">Critical Importance</h3><div class="result-content"><p>You ordered a Chest CT. Widespread "ground-glass" opacities were seen in both lungs on CT. This is the radiological finding of immune-related pneumonitis.</p><div class="report"><strong>CT Report:</strong><br>Extensive ground-glass opacities in both lungs. No evidence of infectious etiology or cardiac failure. Consistent with immune-related pneumonitis.</div></div>';
                            feedbackHTML = '<div class="feedback positive">You took the first step toward correct diagnosis. Immune-related pneumonitis is considered Grade 2. Immunotherapy is temporarily stopped and high-dose steroids are started.</div>';
                            scoreIncrement = 20;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">Overreaction</h3><div class="result-content"><p>You started steroids without ruling out infection. If there is an underlying infection, you may worsen the condition.</p></div>';
                            feedbackHTML = '<div class="feedback negative">Starting immunosuppressive therapy without ruling out infection is risky. Diagnostic evaluation should be performed first.</div>';
                            scoreIncrement = 5;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">Incorrect Diagnosis</h3><div class="result-content"><p>You started antibiotics and treated as pneumonia. Antibiotics are ineffective, the patient continues to deteriorate and may require intensive care.</p></div>';
                            feedbackHTML = '<div class="feedback negative">Immune-related pneumonitis is managed differently from infectious pneumonia. Incorrect diagnosis can lead to serious consequences.</div>';
                            scoreIncrement = 5;
                            break;
                    }
                    break;
            }
            
            // Update time loss and score
            timeLoss += timeLossIncrement;
            score += scoreIncrement;
            
            // Add time loss info if applicable
            if (timeLossIncrement > 0) {
                resultHTML += `<div class="time-loss">Time Loss: +${timeLossIncrement} week (Total: ${timeLoss} weeks)</div>`;
            }
            
            // Add feedback
            resultHTML += feedbackHTML;
            
            // Add continue button
            resultHTML += `<button class="continue-btn" onclick="continueToNextStep(${step})">Continue</button>`;
            
            // Display result
            resultContainer.innerHTML = resultHTML;
        }
        
        function continueToNextStep(step) {
            // Hide current result
            document.getElementById(`result-${step}`).style.display = 'none';
            
            // If this is the last step, show final result
            if (step === totalSteps) {
                showFinalResult();
                return;
            }
            
            // Show next scenario
            currentStep = step + 1;
            document.getElementById(`scenario-${currentStep}`).classList.remove('hidden');
            
            // Update progress
            updateProgress();
        }
        
        function showFinalResult() {
            document.getElementById('final-result').classList.remove('hidden');
            
            let finalHTML = `<p>You have completed the simulation! Here is your performance evaluation:</p>`;
            finalHTML += `<div class="report" style="margin-top: 15px;">`;
            finalHTML += `<p><strong>Total Score: ${score} / 100</strong></p>`;
            finalHTML += `<p><strong>Total Time Loss: ${timeLoss} weeks</strong></p>`;
            finalHTML += `<p><strong>Evaluation:</strong> `;
            
            if (score >= 90) {
                finalHTML += `Excellent! Your clinical decision-making process is very successful.`;
            } else if (score >= 70) {
                finalHTML += `Good! You generally made correct decisions, but there is room for improvement in some areas.`;
            } else if (score >= 50) {
                finalHTML += `Average! You struggled with some critical decision points. It would be beneficial to review the topic again.`;
            } else {
                finalHTML += `There are significant deficiencies in your clinical decision-making process. It is recommended that you study the topic in detail.`;
            }
            
            finalHTML += `</p></div>`;
            
            document.getElementById('final-content').innerHTML = finalHTML;
        }
        
        function restartSimulation() {
            // Reset variables
            currentStep = 1;
            timeLoss = 0;
            score = 0;
            
            // Hide all scenarios and results
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById(`scenario-${i}`).classList.add('hidden');
                document.getElementById(`result-${i}`).style.display = 'none';
            }
            
            // Hide final result
            document.getElementById('final-result').classList.add('hidden');
            
            // Show first scenario
            document.getElementById('scenario-1').classList.remove('hidden');
            
            // Reset progress
            updateProgress();
        }
        
        // Initialize progress bar
        updateProgress();
    </script>
</body>
</html>
