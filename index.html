<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinical Decision Tree Simulation - Lung Cancer</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .scenario-container {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
        }
        
        .scenario-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .scenario-content {
            font-size: 16px;
            line-height: 1.7;
        }
        
        .decision-container {
            margin-top: 25px;
        }
        
        .decision-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            background-color: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .option:hover {
            background-color: #f1f8ff;
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .result-container {
            display: none;
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border-left: 4px solid #e74c3c;
        }
        
        .result-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .result-content {
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 20px;
        }
        
        .continue-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 15px;
        }
        
        .continue-btn:hover {
            background-color: #2980b9;
        }
        
        .time-loss {
            color: #e74c3c;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .report {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: #3498db;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .step-indicator {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .feedback {
            margin-top: 15px;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .positive {
            background-color: #d5f4e6;
            border-left: 4px solid #2ecc71;
        }
        
        .negative {
            background-color: #fdeaea;
            border-left: 4px solid #e74c3c;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Clinical Decision Tree Simulation</h1>
            <div class="subtitle">Lung Cancer Case - Immunotherapy Focus</div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div class="step-indicator" id="step-indicator">Stage 1 / 5</div>
        </header>
        
        <!-- SCENARIO 1 -->
        <div id="scenario-1" class="scenario-container">
            <h2 class="scenario-title">Scenario 1: New Diagnosis</h2>
            <div class="scenario-content">
                <p><strong>Patient:</strong> 58-year-old female with 35 pack/year smoking history.</p>
                <p><strong>Symptoms:</strong> Persistent cough, loss of appetite, unintentional weight loss of 6 kg over 2 months.</p>
                <p><strong>Examination:</strong> Normal.</p>
                <p><strong>Chest X-ray:</strong> Suspicious mass in right lung.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 1A: Your initial imaging choice?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(1, 'A')">A) Contrast-enhanced Chest and Upper Abdomen CT</div>
                    <div class="option" onclick="selectOption(1, 'B')">B) Direct PET-CT</div>
                    <div class="option" onclick="selectOption(1, 'C')">C) Refer patient to Pulmonology</div>
                </div>
            </div>
        </div>

        <!-- SCENARIO 2 -->
        <div id="scenario-2" class="scenario-container hidden">
            <h2 class="scenario-title">Scenario 2: Diagnosis and Staging</h2>
            <div class="scenario-content">
                <p>CT shows a 4.5 cm mass in right upper lobe with pathological lymph nodes.</p>
                <p>Pathology: <strong>Squamous Cell Lung Carcinoma</strong></p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 2: Next step for staging?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(2, 'A')">A) PET-CT for complete staging</div>
                    <div class="option" onclick="selectOption(2, 'B')">B) Brain MRI (patient has headaches)</div>
                    <div class="option" onclick="selectOption(2, 'C')">Bone scan for bone pain assessment</div>
                </div>
            </div>
        </div>

        <!-- SCENARIO 3 -->
        <div id="scenario-3" class="scenario-container hidden">
            <h2 class="scenario-title">Scenario 3: Biomarker Testing</h2>
            <div class="scenario-content">
                <p>Stage: IIIB (T3N2M0). Patient is eligible for targeted therapy or immunotherapy.</p>
                <p>PD-L1 testing result: <strong>60%</strong> (High expression)</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 3: First-line treatment choice?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(3, 'A')">A) Immunotherapy monotherapy</div>
                    <div class="option" onclick="selectOption(3, 'B')">B) Chemotherapy + Immunotherapy</div>
                    <div class="option" onclick="selectOption(3, 'C')">C) Chemotherapy alone</div>
                </div>
            </div>
        </div>

        <!-- SCENARIO 4 -->
        <div id="scenario-4" class="scenario-container hidden">
            <h2 class="scenario-title">Scenario 4: Treatment Monitoring</h2>
            <div class="scenario-content">
                <p>After 3 cycles of immunotherapy, patient develops rash and diarrhea.</p>
                <p>These are Grade 2 immune-related adverse events.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 4: How do you manage these side effects?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(4, 'A')">A) Continue treatment, add topical/symptomatic therapy</div>
                    <div class="option" onclick="selectOption(4, 'B')">B) Hold immunotherapy, start steroids</div>
                    <div class="option" onclick="selectOption(4, 'C')">C) Discontinue immunotherapy permanently</div>
                </div>
            </div>
        </div>

        <!-- SCENARIO 5 -->
        <div id="scenario-5" class="scenario-container hidden">
            <h2 class="scenario-title">Scenario 5: Disease Progression</h2>
            <div class="scenario-content">
                <p>After 9 months, follow-up CT shows new liver metastases.</p>
                <p>The disease has progressed despite initial response.</p>
            </div>
            
            <div class="decision-container">
                <h3 class="decision-title">Decision 5: Next step for progressive disease?</h3>
                <div class="options">
                    <div class="option" onclick="selectOption(5, 'A')">A) Liver biopsy for new genetic testing</div>
                    <div class="option" onclick="selectOption(5, 'B')">B) Switch to chemotherapy</div>
                    <div class="option" onclick="selectOption(5, 'C')">C) Clinical trial referral</div>
                </div>
            </div>
        </div>
        
        <div id="final-result" class="scenario-container hidden">
            <h2 class="scenario-title">Simulation Complete! 🎉</h2>
            <div class="scenario-content" id="final-content">
                <!-- Final content will be populated by JavaScript -->
            </div>
            <button class="continue-btn" onclick="restartSimulation()">Restart Simulation</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let timeLoss = 0;
        let score = 0;
        const totalSteps = 5;
        
        const stepTitles = [
            "New Diagnosis",
            "Diagnosis and Staging",
            "Biomarker Testing",
            "Treatment Monitoring",
            "Disease Progression"
        ];
        
        function updateProgress() {
            const progress = document.getElementById('progress');
            const stepIndicator = document.getElementById('step-indicator');
            const percentage = (currentStep / totalSteps) * 100;
            progress.style.width = `${percentage}%`;
            stepIndicator.textContent = `Stage ${currentStep} / ${totalSteps} - ${stepTitles[currentStep-1]}`;
        }
        
        function selectOption(step, option) {
            // Hide current scenario
            document.getElementById(`scenario-${step}`).classList.add('hidden');
            
            // Show result
            const resultContainer = document.getElementById(`result-${step}`);
            if (resultContainer) {
                resultContainer.style.display = 'block';
            }
            
            let resultHTML = '';
            let feedbackHTML = '';
            let timeLossIncrement = 0;
            let scoreIncrement = 0;
            
            // Process decision for each step
            switch(step) {
                case 1:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">✅ Correct Approach</h3><div class="result-content"><p>You ordered Contrast-enhanced Chest CT. This is the most appropriate first step for anatomical evaluation.</p></div>';
                            scoreIncrement = 20;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">⚠️ Suboptimal Choice</h3><div class="result-content"><p>PET-CT is excellent for staging but contrast CT provides better anatomical detail for biopsy planning.</p></div>';
                            timeLossIncrement = 1;
                            scoreIncrement = 10;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">❌ Delayed Diagnosis</h3><div class="result-content"><p>Direct referral without initial imaging causes unnecessary delay in diagnosis.</p></div>';
                            timeLossIncrement = 2;
                            scoreIncrement = 5;
                            break;
                    }
                    break;
                    
                case 2:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">✅ Comprehensive Staging</h3><div class="result-content"><p>PET-CT provides complete staging information for treatment planning.</p></div>';
                            scoreIncrement = 20;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">⚠️ Limited Staging</h3><div class="result-content"><p>Brain MRI is important but PET-CT provides more comprehensive staging.</p></div>';
                            scoreIncrement = 15;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">❌ Incomplete Approach</h3><div class="result-content"><p>Bone scan alone is insufficient for complete lung cancer staging.</p></div>';
                            timeLossIncrement = 1;
                            scoreIncrement = 5;
                            break;
                    }
                    break;
                    
                case 3:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">✅ Guideline-Recommended</h3><div class="result-content"><p>With PD-L1 ≥50%, immunotherapy monotherapy is standard first-line treatment.</p></div>';
                            scoreIncrement = 25;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">⚠️ Alternative Option</h3><div class="result-content"><p>Chemo-immunotherapy is also effective but monotherapy preferred for high PD-L1.</p></div>';
                            scoreIncrement = 15;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">❌ Suboptimal Choice</h3><div class="result-content"><p>With high PD-L1, immunotherapy provides better outcomes than chemotherapy alone.</p></div>';
                            scoreIncrement = 5;
                            break;
                    }
                    break;
                    
                case 4:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">✅ Appropriate Management</h3><div class="result-content"><p>Grade 2 irAEs can often be managed with supportive care while continuing treatment.</p></div>';
                            scoreIncrement = 20;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">⚠️ Overly Aggressive</h3><div class="result-content"><p>Steroids may not be needed yet for Grade 2 events. Try symptomatic management first.</p></div>';
                            scoreIncrement = 10;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">❌ Premature Discontinuation</h3><div class="result-content"><p>Grade 2 events don\'t typically require permanent discontinuation of effective therapy.</p></div>';
                            scoreIncrement = 5;
                            break;
                    }
                    break;
                    
                case 5:
                    switch(option) {
                        case 'A':
                            resultHTML = '<h3 class="result-title">✅ Optimal Approach</h3><div class="result-content"><p>Biopsy at progression can reveal new mutations and guide next-line therapy.</p></div>';
                            scoreIncrement = 25;
                            break;
                        case 'B':
                            resultHTML = '<h3 class="result-title">⚠️ Reasonable Alternative</h3><div class="result-content"><p>Chemotherapy is standard but re-biopsy can provide personalized options.</p></div>';
                            scoreIncrement = 15;
                            break;
                        case 'C':
                            resultHTML = '<h3 class="result-title">⚠️ Good Consideration</h3><div class="result-content"><p>Clinical trials are excellent but should include tissue analysis when possible.</p></div>';
                            scoreIncrement = 15;
                            break;
                    }
                    break;
            }
            
            // Update scores
            timeLoss += timeLossIncrement;
            score += scoreIncrement;
            
            // Build result display
            let displayHTML = resultHTML;
            
            if (timeLossIncrement > 0) {
                displayHTML += `<div class="time-loss">Time Loss: +${timeLossIncrement} week (Total: ${timeLoss} weeks)</div>`;
            }
            
            displayHTML += feedbackHTML;
            
            // Show next scenario or final result
            if (step < totalSteps) {
                displayHTML += `<button class="continue-btn" onclick="nextScenario(${step})">Continue to Next Scenario</button>`;
                if (resultContainer) {
                    resultContainer.innerHTML = displayHTML;
                }
            } else {
                // Last scenario - show final results
                showFinalResult();
                return;
            }
            
            if (resultContainer) {
                resultContainer.innerHTML = displayHTML;
            }
            updateProgress();
        }
        
        function nextScenario(currentStep) {
            // Hide current result
            const currentResult = document.getElementById(`result-${currentStep}`);
            if (currentResult) {
                currentResult.style.display = 'none';
            }
            
            // Show next scenario
            const nextStep = currentStep + 1;
            document.getElementById(`scenario-${nextStep}`).classList.remove('hidden');
            
            // Update progress
            currentStep = nextStep;
            updateProgress();
        }
        
        function showFinalResult() {
            // Hide all scenarios and results
            for (let i = 1; i <= totalSteps; i++) {
                const scenario = document.getElementById(`scenario-${i}`);
                const result = document.getElementById(`result-${i}`);
                if (scenario) scenario.classList.add('hidden');
                if (result) result.style.display = 'none';
            }
            
            // Show final result
            document.getElementById('final-result').classList.remove('hidden');
            
            let finalHTML = `<p>You have completed the clinical simulation! Here is your performance evaluation:</p>`;
            finalHTML += `<div class="report" style="margin-top: 15px;">`;
            finalHTML += `<p><strong>Total Score: ${score} / 100</strong></p>`;
            finalHTML += `<p><strong>Total Time Loss: ${timeLoss} weeks</strong></p>`;
            finalHTML += `<p><strong>Clinical Competency:</strong> `;
            
            if (score >= 90) {
                finalHTML += `Excellent! Your clinical decision-making demonstrates advanced expertise.`;
            } else if (score >= 70) {
                finalHTML += `Proficient! You made mostly correct clinical decisions with some areas for refinement.`;
            } else if (score >= 50) {
                finalHTML += `Developing! There are significant opportunities to improve your clinical decision-making.`;
            } else {
                finalHTML += `Needs improvement! Review lung cancer guidelines and treatment protocols.`;
            }
            
            finalHTML += `</p></div>`;
            
            document.getElementById('final-content').innerHTML = finalHTML;
        }
        
        function restartSimulation() {
            // Reset variables
            currentStep = 1;
            timeLoss = 0;
            score = 0;
            
            // Hide all scenarios and results
            for (let i = 1; i <= totalSteps; i++) {
                const scenario = document.getElementById(`scenario-${i}`);
                const result = document.getElementById(`result-${i}`);
                if (scenario) scenario.classList.add('hidden');
                if (result) result.style.display = 'none';
            }
            
            // Show first scenario
            document.getElementById('scenario-1').classList.remove('hidden');
            document.getElementById('final-result').classList.add('hidden');
            
            // Reset progress
            updateProgress();
        }
        
        // Initialize
        updateProgress();
    </script>
</body>
</html>
